config:
  fourdays_fore: $(new("org.joda.time.DateTime").minusDays(4).toString("yyyy-MM-dd"))
  curday: $(new("org.joda.time.DateTime").minusDays(-1).toString("yyyy-MM-dd"))
  nowday: $(new("org.joda.time.DateTime").minusDays(1).toString("yyyy-MM-dd"))
  mode: 2
  failure.emails: mafangqiang@longi.com

nodes:
  - name: device_index
    type: noop

  - name: device_portrait_data
    type: command
    config:
      command: su - mafq -c "spark-submit --class com.longi.dwd.IngotDevicePortraitAllBase --master yarn --deploy-mode client --driver-memory 6g --num-executors 6 --executor-memory 6g --executor-cores 6 --queue spark --conf spark.shuffle.service.enabled=true --conf spark.executor.memoryOverhead=2G --conf spark.sql.session.timeZone=Asia/Shanghai --conf spark.sql.catalogImplementation=hive --name device_index --jars /home/mafq/task/longi_ingot_devices/ojdbc6-11.2.0.3.jar /home/mafq/test/etl-bi-ingot-device-portrait-1.3-SNAPSHOT-dependencies.jar ${fourdays_fore} ${curday}"
    dependsOn:
      - device_index

  - name: refresh_kylin_table
    type: command
    config:
      command: impala-shell -i worker05.longi:21001 -q 'refresh dwd_pp_ingot.ingot_device_portrait'
    dependsOn:
      - device_portrait_data