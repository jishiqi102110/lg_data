config:
  fourdays_fore: $(new("org.joda.time.DateTime").minusDays(4).toString("yyyy-MM-dd"))
  curday: $(new("org.joda.time.DateTime").minusDays(-1).toString("yyyy-MM-dd"))
  nowday: $(new("org.joda.time.DateTime").minusDays(1).toString("yyyy-MM-dd"))
  mode: 2
  failure.emails: liangweitao2@longi.com

nodes:
  - name: device_index
    type: noop

  - name: device_portrait_data
    type: command
    config:
      command: su - liangwt -c "spark-submit --class warehouse.dwd.scada.IngotDevicePortraitAllBase --master yarn --deploy-mode client --driver-memory 6g --num-executors 8 --executor-memory 10g --executor-cores 2 --queue spark --conf spark.shuffle.service.enabled=true  --conf spark.default.parallelism=300  --conf spark.sql.session.timeZone=Asia/Shanghai --conf spark.sql.catalogImplementation=hive --name device_index_temp /home/liangwt/jar/silicon_data_flow-1.0-SNAPSHOT-dependencies.jar ${fourdays_fore} ${curday}"
    dependsOn:
      - device_index

  - name: refresh_kylin_table
    type: command
    config:
      command: impala-shell -i worker05.longi:21001 -q 'refresh dwd_pp_ingot.ingot_device_portrait'
    dependsOn:
      - device_portrait_data